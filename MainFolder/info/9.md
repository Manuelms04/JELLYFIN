<h2 align="center">ðŸ“‚ IntegraciÃ³n de Samba para Compartir Archivos Multimedia Automatizada con Ansible ðŸ“‚</h2>

*Para facilitar el acceso y la carga de archivos multimedia desde otros equipos de la red local, se ha automatizado el sistema de comparticiÃ³n de carpetas mediante* `Ansible`

---

### `Paso 1`: InstalaciÃ³n de Samba

- Utilizando un `Playbook de Ansible`, se instala automÃ¡ticamente `Samba` en el sistema Debian

```yaml
- name: Instalar Samba
  apt:
    name: samba
    state: present
    update_cache: yes
```

---

### `Paso 2`: Crear Carpeta Compartida con Permisos

- El rol de `Ansible` crea la carpeta para compartir archivos multimedia:

```yaml
- name: Crear carpeta compartida
  file:
    path: "/home/manuelms/MediaCompartida"
    state: directory
    owner: root
    group: root
    mode: '0775'
```

---

### `Paso 3`: Crear Usuario `Samba`

- El usuario `Samba` se crea y se aÃ±ade automÃ¡ticamente con `Ansible` mediante comandos:

```yaml
- name: Crear usuario de sistema para Samba
  user:
    name: samba
    state: present
    shell: /usr/sbin/nologin

- name: AÃ±adir usuario Samba con contraseÃ±a predeterminada
  command: echo -ne 'samba123\nsamba123\n' | smbpasswd -s -a samba
```

> *Este serÃ¡ el usuario con el que se accede desde Windows u otros sistemas*

---

### `Paso 4`: ConfiguraciÃ³n del archivo `smb.conf`

- Ansible reemplaza el archivo `smb.conf` utilizando una plantilla `Jinja2` con la configuraciÃ³n de la carpeta compartida. Puedes almacenar este contenido en `roles/samba/templates/smb.conf.j2:`

```ini
[global]
   workgroup = WORKGROUP
   security = user
   map to guest = bad user

[Media]
   path = /home/manuelms/MediaCompartida
   writable = yes
   browseable = yes
   valid users = samba
   create mask = 0664
   directory mask = 0775
```

- El task de `Ansible` que copia esta plantilla serÃ­a:

```yaml
- name: Copiar configuraciÃ³n personalizada de Samba
  template:
    src: smb.conf.j2
    dest: /etc/samba/smb.conf
    owner: root
    group: root
    mode: '0644'
```

> *ExplicaciÃ³n de parÃ¡metros*

- `path`: Ruta de la carpeta compartida

- `writable`: Permite escribir en la carpeta

- `browseable`: Hace visible la carpeta en la red

- `valid users`: Usuario autorizado para acceder

- `create mask`: Permisos por defecto para archivos

- `directory mask`: Permisos por defecto para carpetas

---

### `Paso 5`: Reiniciar el servicio Samba

- Con `Ansible`, se reinicia el servicio automÃ¡ticamente tras aplicar la configuraciÃ³n:

```yaml
- name: Reiniciar servicio Samba
  service:
    name: smbd
    state: restarted
    enabled: yes
```

---

### `Paso 6`: Acceso desde otros equipos

- Desde el explorador de archivos de otro dispositivo:

```bash
\\IP_DE_LA_MV\Media
```

> *Introducir las credenciales del usuario Samba cuando lo solicite*


### `Paso 7`: Integrar con `Jellyfin`

- Para que `Jellyfin` acceda a la carpeta compartida como su biblioteca multimedia, modificar el volumen en el archivo docker-compose.yml:

```yaml
volumes:
  - /home/manuelms/MediaCompartida:/media
```

### Estructura de Archivos de `Ansible`

```arduino
ansible-samba-setup/
â”œâ”€â”€ playbook.yml
â”œâ”€â”€ hosts
â””â”€â”€ roles/
    â””â”€â”€ samba/
        â”œâ”€â”€ tasks/
        â”‚   â””â”€â”€ main.yml
        â””â”€â”€ templates/
            â””â”€â”€ smb.conf.j2
```

### EjecuciÃ³n del `Playbook`

Para ejecutar el `Playbook`, asegÃºrate de tener `Ansible` instalado y configura tu archivo de hosts, luego ejecuta:

```bash
ansible-playbook -i hosts playbook.yml
```













---
---
---

---
---

---
---
---
---
---
---





<h2 align="center">ðŸ“‚ IntegraciÃ³n de Samba para Compartir Archivos Multimedia ðŸ“‚</h2>

*Para facilitar el acceso y la carga de archivos multimedia desde otros equipos de la red local, se ha integrado un sistema de comparticiÃ³n de carpetas mediante*

---

### `Paso 1`: InstalaciÃ³n de Samba

- Ejecutar los siguientes comandos en la terminal de la mÃ¡quina virtual Debian

```bash
sudo apt update
sudo apt install samba -y
```

![](/MainFolder/img/.png)

---

### `Paso 2`: Crear Carpeta Compartida con Permisos

- Crear una carpeta destinada al almacenamiento compartido de archivos multimedia

```bash
sudo mkdir -p /home/manuelms/MediaCompartida
```

![](/MainFolder/img/.png)

- Asignar permisos lectura, escritura y ejecuciÃ³n al propietario y grupo, y lectura y ejecuciÃ³n a otros usuarios
  
```bash
sudo chmod -R 775 /home/manuelms/MediaCompartida
```

![](/MainFolder/img/.png)

---

### `Paso 3`: Crear Usuario Samba</h3>

- AÃ±adir un usuario Samba para acceder desde otros dispositivos de la red

```bash
sudo smbpasswd -a samba
```

![](/MainFolder/img/.png)

> *Este serÃ¡ el usuario con el que se accede desde Windows u otros sistemas*

---

### `Paso 4`: ConfiguraciÃ³n del archivo `smb.conf`

- Editar el archivo de configuraciÃ³n de Samba:

```bash
sudo nano /etc/samba/smb.conf
```

![](/MainFolder/img/.png)

- AÃ±adir al final del archivo:

```java
[Media]
   path = /home/manuelms/MediaCompartida
   writable = yes
   browseable = yes
   valid users = samba
   create mask = 0664
   directory mask = 0775
```

![](/MainFolder/img/.png)

> *ExplicaciÃ³n de parÃ¡metros*

- `path`: Ruta de la carpeta compartida

- `writable`: Permite escribir en la carpeta

- `browseable`: Hace visible la carpeta en la red

- `valid users`: Usuario autorizado para acceder

- `create mask`: Permisos por defecto para archivos

- `directory mask`: Permisos por defecto para carpetas

---

### `Paso 5`: Reiniciar el servicio Samba

```bash
sudo systemctl restart smbd
```

![](/MainFolder/img/.png)

---

### `Paso 6`: Acceso desde otros equipos

- Desde el explorador de archivos de otro dispositivo: 

```bash
\\IP_DE_LA_MV\Media
```

![](/MainFolder/img/.png)

 > *Introduce las credenciales del usuario Samba cuando lo solicite*

---

### `Paso 7`: Integrar con Jellyfin

- Para que Jellyfin acceda a la carpeta compartida como su biblioteca multimedia, modificar el volumen en el archivo `docker-compose.yml`

```yaml
volumes:
  - /home/manuelms/MediaCompartida:/media
```

![](/MainFolder/img/.png)
